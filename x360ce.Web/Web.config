<?xml version="1.0" encoding="utf-8"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
  http://go.microsoft.com/fwlink/?LinkId=169433
  -->
<configuration>
  <connectionStrings>
    <add name="JocysCom.WebSites.Engine.Properties.Settings.DefaultConnectionString" connectionString="Data Source=localhost;Initial Catalog=x360ce;User ID=x360ceAdmin;Password=localdev;" providerName="System.Data.SqlClient" />
    <add name="x360ceModelContainer" connectionString="metadata=res://*/Data.x360ceModel.csdl|res://*/Data.x360ceModel.ssdl|res://*/Data.x360ceModel.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=localhost;initial catalog=x360ce;persist security info=True;user id=x360ceAdmin;password=localdev;multipleactiveresultsets=True;application name=EntityFramework&quot;" providerName="System.Data.EntityClient" />
    <add name="SecurityEntities" connectionString="metadata=res://*/JocysCom.Security.Data.SecurityModel.csdl|res://*/JocysCom.Security.Data.SecurityModel.ssdl|res://*/JocysCom.Security.Data.SecurityModel.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=localhost;initial catalog=x360ce;persist security info=True;user id=x360ceAdmin;password=localdev;multipleactiveresultsets=True;application name=EntityFramework&quot;" providerName="System.Data.EntityClient" />
  </connectionStrings>
  <appSettings>
    <add key="ChartImageHandler" value="storage=file;timeout=20;dir=c:\Temp\;" />
    <add key="OverridePrograms" value="~/Files/x360ce_Games.xml" />
    <add key="Security_Administrators" value="" />
    <add key="Security_PowerUsers" value="" />
    <add key="Security_DefaultRole" value="x360ceUsers" />
    <add key="Security_LoginRememberMinutes" value="10080" />
    <add key="Security_AllowUsersToResetPassword" value="True" />
    <add key="Security_AllowUsersToSignUp" value="True" />
    <add key="Security_AllowUsersToLogin" value="False" />
    <add key="Security_RequiredFields" value="UserName,Password,Email,Terms" />
    <add key="Security_OptionalFields" value="FirstName,LastName" />
    <add key="RunMode" value="TEST" />
    <!-- Error Reporting -->
    <add key="ErrorRecipients" value="info@x360ce.com" />
    <add key="ErrorNotifications" value="True" />
    <!-- Maximum 10 errors of same type per 5 minutes (2880 per day). -->
    <add key="ErrorMailLimitMax" value="10" />
    <add key="ErrorMailLimitAge" value="00:05:00" />
    <!-- Encryption -->
    <add key="AppEncryptionHmacHashKey" value="Developer1234" />
    <add key="CloudHmacHashKey" value="CloudHmac" />
    <add key="CloudRsaPublicKey" value="BgIAAACkAABSU0ExAAgAAAEAAQBpOYlmBiOd8f/GV7jAQzP4d5HO7FFuqqug5ZDo9VGGe1tO99YXUysnEOKJhbnhDT/DbxcHSFF5bBHhWXZu3kKSrT5G288PYSzCFix4qIHVoj13mpsNFW1xtIaTRbbYwrZ4EGowta8dNCi9WYow6ML53ii2zXcEBFP3xUnYSHSuHbEpbOTaIlfs1Y+Vwsamt+BZf0Kct3i+8VKrSF3LM+gFN0IcHuWDcXioHpG5xv1mpfh5Y1Mch9klNdf8KvIsf2qdiP0BgcIy7994Wqteaip2hgoj/BC6ceyNm/WFNtK+YVvm7sblj6UiFqEo6ywXjGoLMr7UI1UVxHGFIbLWzwe8" />
    <add key="CloudRsaPrivateKey" value="BwIAAACkAABSU0EyAAgAAAEAAQBpOYlmBiOd8f/GV7jAQzP4d5HO7FFuqqug5ZDo9VGGe1tO99YXUysnEOKJhbnhDT/DbxcHSFF5bBHhWXZu3kKSrT5G288PYSzCFix4qIHVoj13mpsNFW1xtIaTRbbYwrZ4EGowta8dNCi9WYow6ML53ii2zXcEBFP3xUnYSHSuHbEpbOTaIlfs1Y+Vwsamt+BZf0Kct3i+8VKrSF3LM+gFN0IcHuWDcXioHpG5xv1mpfh5Y1Mch9klNdf8KvIsf2qdiP0BgcIy7994Wqteaip2hgoj/BC6ceyNm/WFNtK+YVvm7sblj6UiFqEo6ywXjGoLMr7UI1UVxHGFIbLWzwe8ZbvirItJLy1egZ64LzpM2tRGDjY7GA0UHIkF+f0+yigju9PAvS09ke/5Uv//k3smgFyHL3KWt9BjxGEQ22nk82RFImy8OO+c6e6knZvZl7D2SVXAuJhrp0+CY4Jm2pCXSMlYwWSizV3e4q1OLGpPrLTGL5fhlUBa35pF0lr4x/O1n4u4OONnQvxgDjCVxEfHPA/D236R0aJOrjAyHJAH5s6M24jnjeYd9UOOBjH6/nw4ddxW/V07sdcIbJUeIQwcnuuwppnXAwDb2RBO2cWsJHfdhOydIzP19/bD/NUHI4CBK7XGBy69r9Zd3ET/h8bc7netTULS+GVXWcKcFH10xeFnvcpaRgZjjbg3zQZ5rHkLzu7b/BlhZC18bOrPG24IBCyqGbvjeEJbPYp8CuMfC7yIpSvCbwzjgt/3PZgL6Tkt9Ujq4ScTSbGdTnzW9puusLtCJTymWxc5u7lmbdd6fz36zcnxHRU4oxVdyQrfkP2jVlbQHSXPlW2UL4PeCySXHQDeGwoIDa+7WAZGPgAsShDskUTXl4LRd0Hlfgz0jwFB98Lt59Kt/0bxsT5CEdIAkzPYLRa/j/lZ/XsPfteCIIL5+eoRJIdHzHefj1jiTF/yhBvx+LLPokrxUHSnLHFkCXC9gUNuMoqDCS2T8I6MFNCHA+Uw1SlX1wE2P8VzYXx91/qlakiUMwMmUdf/Kfv7ZpnHeX0Mv+WFzDtFZYHCUWolEZ8N/ZNiV2RwvDSNyv8B8/ggYvce2uMZ35WiUQjybB5w630ZUCYKZEhtgMMAfWwDkJ2/V1Z46eLUu5SUoS1lTTyvX903xE9qIpTx9rvSdEvW9y2qIKoSuUSKgW87h/GL3NOupvlIM4EgsDCh+UuK2tVIjlO8tErW5+udQgib30RRdk8heMfUIlTSoZ+QmDsILzPaO9xir4lTaNZvxpaPpwdkL+BohRFyfpMZgnmZTPh+mg4ZdOatMRxH1pFEdSneUsVDoZIYT1K/2SiQHJpnHpPCmeeLMxmBMLySVzwkRtM/Y5yOs3gVqLoALRSxz1q93p+bivFClaNlnT5K0YJLKIhNMfFe9gIGjaEpJ3Bz0iHkazSXgKUulfRwL9JtWQuLiMcNKtuHjPaZ7oPxJ+vmFlY+Kk6OPOZEls2efMGsKfhvypduandLKPXmYP0S4xHVJAjQwr6aTAyIF2Pj1xg=" />
    <!-- Trace WebService -->
    <add key="TraceExtension_LogFileOn" value="true" />
    <add key="TraceExtension_LogBrowserCompatible" value="false" />
    <add key="TraceExtension_LogFileDirectory" value="c:\ProgramData\X360CE\Logs" />
  </appSettings>
  <system.net>
    <!-- Error notifications if enabled. -->
    <mailSettings>
      <smtp from="noreply@x360ce.com">
        <network host="jocys.com" enableSsl="true" />
      </smtp>
    </mailSettings>
  </system.net>
  <!-- Allow Authorization -->
  <location path="Security/Admin">
    <system.web>
      <authorization>
        <allow roles="Administrators" />
        <deny users="*" />
      </authorization>
    </system.web>
  </location>
  <!--IIS 6.0 Configuration - Classic Mode -->
  <!--
    For a description of web.config changes see http://go.microsoft.com/fwlink/?LinkId=235367.

    The following attributes can be set on the <httpRuntime> tag.
      <system.Web>
        <httpRuntime targetFramework="4.8" />
      </system.Web>
  -->
  <system.web>
    <customErrors mode="Off" />
    <!-- Fix Information Disclosure vulnerability by removing 'X-AspNet-Version' header with enableVersionHeader="false" attribute. -->
    <httpRuntime enableVersionHeader="false" />
    <httpHandlers>
      <add path="ChartImg.axd" verb="GET,HEAD,POST" type="System.Web.UI.DataVisualization.Charting.ChartHttpHandler, System.Web.DataVisualization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" validate="false" />
    </httpHandlers>
    <compilation debug="true" targetFramework="4.8">
      <assemblies>
        <add assembly="System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
        <add assembly="System.Web.DataVisualization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
      </assemblies>
    </compilation>
    <!--
    The <authentication> section enables configuration 
    of the security authentication mode used by 
    ASP.NET to identify an incoming user. 
    -->
    <authentication mode="Forms">
      <forms name=".X360CE_AUTH" loginUrl="Login.aspx" protection="All" path="/" timeout="30" slidingExpiration="true" />
    </authentication>
    <!-- 
      Configures keys to use for encryption and decryption of forms authentication cookie
      data and view state data, and for verification of out-of-process session state
      identification. This section can be declared at the machine, site, and application
      levels, but not at the subdirectory level.
      -->
    <machineKey validationKey="032ABA2D2134D388BB4560DAE2BFB15403048909DFCBFD2716EB25091BC10EB7F0B47054CB841688569511CCAF02D90F165D6BF97DF0E8EA28B105C31FD33A70" decryptionKey="6CBBB7ECB3E9F931B899335A5FF53A2C7AF0A0D702F592C4" validation="SHA1" />
    <membership userIsOnlineTimeWindow="60" defaultProvider="AspNetSqlMembershipProvider">
      <!-- http://msdn2.microsoft.com/en-us/library/system.web.security.sqlmembershipprovider_properties.aspx -->
      <providers>
        <clear />
        <add name="AspNetSqlMembershipProvider" applicationName="/" connectionStringName="JocysCom.WebSites.Engine.Properties.Settings.DefaultConnectionString" type="System.Web.Security.SqlMembershipProvider, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" passwordFormat="Encrypted" enablePasswordRetrieval="true" enablePasswordReset="true" maxInvalidPasswordAttempts="64" passwordAttemptWindow="128" minRequiredPasswordLength="1" minRequiredNonalphanumericCharacters="0" requiresQuestionAndAnswer="false" requiresUniqueEmail="true" />
      </providers>
    </membership>
    <profile>
      <providers>
        <clear />
        <add name="AspNetSqlProfileProvider" applicationName="/" connectionStringName="JocysCom.WebSites.Engine.Properties.Settings.DefaultConnectionString" type="System.Web.Profile.SqlProfileProvider, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
      </providers>
    </profile>
    <roleManager enabled="true">
      <providers>
        <clear />
        <add name="AspNetSqlRoleProvider" applicationName="/" connectionStringName="JocysCom.WebSites.Engine.Properties.Settings.DefaultConnectionString" type="System.Web.Security.SqlRoleProvider, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
        <!-- add name="AspNetWindowsTokenRoleProvider" applicationName="/"
          type="System.Web.Security.WindowsTokenRoleProvider, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        / -->
      </providers>
    </roleManager>
    <pages controlRenderingCompatibilityVersion="4.0">
      <controls>
        <add tagPrefix="asp" namespace="System.Web.UI.DataVisualization.Charting" assembly="System.Web.DataVisualization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
      </controls>
    </pages>
    <webServices>
      <protocols>
        <add name="HttpPost" />
        <add name="HttpGet" />
      </protocols>
    </webServices>
  </system.web>
  <!--IIS 7.0+ Configuration - Integrated Mode -->
  <system.webServer>
    <security>
      <!-- Fix Information Disclosure vulnerability by removing 'Server' header from HTTP response.
        Note: Works on IIS 8.0+ only and required Request Filtering module on IIS. -->
      <!--<requestFiltering removeServerHeader="true">-->
    </security>
    <!-- Fix Information Disclosure vulnerability by making sure that even static content will use Global.asax.cs -->
    <!-- Please note that extra CPU resources will be used. -->
    <modules runAllManagedModulesForAllRequests="true">
      <!-- Enabling HTTP tracing in ASP.NET Web Services -->
      <add name="MyHttpModule" type="JocysCom.ClassLibrary.Diagnostics.RawDataLogHttpModule,x360ce.Engine" />
    </modules>
    <validation validateIntegratedModeConfiguration="false" />
    <handlers>
      <remove name="UrlRoutingHandler" />
      <!--<add name="UrlRoutingHandler" preCondition="integratedMode" verb="*" path="UrlRouting.axd" type="System.Web.Routing.UrlRoutingHandler, System.Web.Routing, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>-->
      <!-- Replace 3.5  with 2.0 in order for DynamicData to work. -->
      <remove name="ChartImageHandler" />
      <add name="ChartImageHandler" preCondition="integratedMode" verb="GET,HEAD,POST" path="ChartImg.axd" type="System.Web.UI.DataVisualization.Charting.ChartHttpHandler, System.Web.DataVisualization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
    </handlers>
    <defaultDocument>
      <files>
        <remove value="default.aspx" />
        <remove value="iisstart.htm" />
        <remove value="index.html" />
        <remove value="index.htm" />
        <remove value="Default.asp" />
        <remove value="Default.htm" />
        <add value="Default.asp" />
        <add value="Default.aspx" />
        <add value="Default.htm" />
      </files>
    </defaultDocument>
    <rewrite>
      <rules>
        <clear />
        <rule name="To www" stopProcessing="true">
          <match url="(.*)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="^[a-z0-9]+\.(co\.uk|lt|com|eu)$" />
          </conditions>
          <action type="Redirect" url="{MapSSL:{HTTPS}}www.{HTTP_HOST}/{R:1}" redirectType="Permanent" />
        </rule>
        <rule name="To http://www.x360ce.com" stopProcessing="true">
          <match url="(.*)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="^www\.xboxce\.com$" />
          </conditions>
          <action type="Redirect" url="http://www.x360ce.com/{R:1}" redirectType="Permanent" />
        </rule>
        <rule name="Redirect" stopProcessing="true">
          <match url="^Redirect/(.*)" />
          <conditions logicalGrouping="MatchAll" />
          <action type="Redirect" url="http://{R:1}" redirectType="Permanent" />
        </rule>
        <rule name="DebugTestFiles" stopProcessing="true">
          <match url="^Files/(.*beta\.zip)" />
          <conditions logicalGrouping="MatchAll" />
        </rule>
        <rule name="RedirectFiles" stopProcessing="true">
          <match url="^Files/(.*)" />
          <conditions logicalGrouping="MatchAll" />
          <action type="Redirect" url="https://github.com/x360ce/x360ce/blob/master/x360ce.Web/Files/{R:1}?raw=true" />
        </rule>
        <!--<rule name="To https://github.com/x360ce/x360ce" stopProcessing="true">
          <match url="^$" />
          <conditions logicalGrouping="MatchAll">
          <add input="{HTTP_HOST}" pattern="^www\.x360ce\.com$" />
          </conditions>
          <action type="Redirect" url="https://github.com/x360ce/x360ce" redirectType="Permanent" />
        </rule>-->
      </rules>
      <rewriteMaps>
        <rewriteMap name="MapSSL" defaultValue="OFF">
          <add key="ON" value="https://" />
          <add key="OFF" value="http://" />
        </rewriteMap>
      </rewriteMaps>
      <outboundRules>
        <!-- Fix Missing HTTP Header vulnerability -->
        <!-- Send "strict-transport-security: max-age=31536000" response header when user can trust website over HTTPS -->
        <!-- This will force browser to stay on HTTPS even if domain links points to non-secure HTTP -->
        <!-- Browser will remember this option. You can clear it on Internet Explorer: F12 -> Network -> [Clear Cache] button.  -->
        <!--<rule name="Add Strict-Transport-Security when HTTPS - LIVE" enabled="true">
          <match serverVariable="RESPONSE_Strict_Transport_Security" pattern=".*" />
          <conditions>
            <add input="{HTTPS}" pattern="ON" />
            -->
        <!-- Exclude DEV, TEST and local machine (debugging). -->
        <!--
            <add input="{HTTP_HOST}" pattern="^\w*(dev|test|local)" negate="true" />
          </conditions>
          -->
        <!-- All present and future sub-domains will be HTTPS for a max-age of 1 year. -->
        <!--
          <action type="Rewrite" value="max-age=31536000; includeSubDomains" />
        </rule>
        <rule name="Add Strict-Transport-Security when HTTPS - TEST" enabled="true">
          <match serverVariable="RESPONSE_Strict_Transport_Security" pattern=".*" />
          <conditions>
            <add input="{HTTPS}" pattern="ON" />
            -->
        <!-- Include DEV, TEST and local machine (debugging). -->
        <!--
            <add input="{HTTP_HOST}" pattern="^\w*(dev|test|local)" />
          </conditions>
          -->
        <!-- All present and future sub-domains will be HTTPS for a max-age of 10 seconds. 10 -->
        <!--
          <action type="Rewrite" value="max-age=10; includeSubDomains" />
        </rule>-->
      </outboundRules>
    </rewrite>
    <httpProtocol>
      <!-- Test: https://www.immuniweb.com/websec -->
      <customHeaders>
        <remove name="X-Powered-By" />
        <!-- SECURITY HEADERS - https://securityheaders.io/? -->
        <!-- Protects against Clickjacking attacks. ref.: http://stackoverflow.com/a/22105445/1233379 -->
        <add name="X-Frame-Options" value="SAMEORIGIN" />
        <!-- Protects against Clickjacking attacks. ref.: https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet -->
        <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains" />
        <!-- Protects against XSS injections. ref.: https://www.veracode.com/blog/2014/03/guidelines-for-setting-security-headers/ -->
        <add name="X-XSS-Protection" value="1; mode=block" />
        <!-- Protects against MIME-type confusion attack. ref.: https://www.veracode.com/blog/2014/03/guidelines-for-setting-security-headers/ -->
        <add name="X-Content-Type-Options" value="nosniff" />
        <!-- CSP modern XSS directive-based defence, used since 2014. ref.: http://content-security-policy.com/ -->
        <add name="Content-Security-Policy" value="default-src 'self'; connect-src *; font-src *; child-src *; img-src * data:; media-src *; object-src *; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline';" />
        <!-- Prevents from leaking referrer data over insecure connections. ref.: https://scotthelme.co.uk/a-new-security-header-referrer-policy/ -->
        <add name="Referrer-Policy" value="strict-origin" />
        <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy -->
        <add name="Feature-Policy" value="camera 'none'; microphone 'none'; payment 'none';" />
        <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT -->
        <add name="Expect-CT" value="enforce, max-age=2592000" />
      </customHeaders>
    </httpProtocol>
    <staticContent>
      <clientCache cacheControlMode="NoControl" />
    </staticContent>
  </system.webServer>
  <system.serviceModel>
    <!-- Enabling Tracing in Web Services -->
    <diagnostics>
      <messageLogging logMessagesAtTransportLevel="true" logMessagesAtServiceLevel="true" logMalformedMessages="true" logEntireMessage="true" maxSizeOfMessageToLog="65535000" maxMessagesToLog="500" />
    </diagnostics>
  </system.serviceModel>
  <system.diagnostics>
    <sources>
      <!-- Enabling Tracing in ASP.NET Web Services -->
      <source name="System.Web.Services.Asmx" switchValue="Verbose">
        <listeners>
          <add name="TraceRolFile" type="" />
        </listeners>
      </source>
      <!-- Enabling HTTP tracing in ASP.NET Web Services -->
      <source name="RawDataLogHttpModule" switchValue="Verbose">
        <listeners>
          <add name="TraceRawFile" />
        </listeners>
      </source>
    </sources>
    <sharedListeners>
      <!-- Files can be opened with SvcTraceViewer.exe. make sure that IIS_IUSRS group has write permissions on this folder. -->
      <add name="TraceSvcFile" type="System.Diagnostics.XmlWriterTraceListener" initializeData="c:\ProgramData\X360CE\Logs\WebServices.svclog" traceOutputOptions="LogicalOperationStack, DateTime, Timestamp, ProcessId, ThreadId" />
      <add name="TraceRolFile" type="JocysCom.ClassLibrary.Diagnostics.RollingXmlWriterTraceListener, x360ce.Engine" initializeData="c:\ProgramData\X360CE\Logs\WebServices.svclog" traceOutputOptions="LogicalOperationStack, DateTime, Timestamp, ProcessId, ThreadId" />
      <add name="TraceRawFile" type="JocysCom.ClassLibrary.Diagnostics.RollingXmlWriterTraceListener, x360ce.Engine" initializeData="c:\ProgramData\X360CE\Logs\WebServicesRaw.svclog" traceOutputOptions="LogicalOperationStack, DateTime, Timestamp, ProcessId, ThreadId" />
      <add name="TraceLogFile" type="System.Diagnostics.TextWriterTraceListener" initializeData="c:\ProgramData\X360CE\Logs\WebServices.log" traceOutputOptions="LogicalOperationStack, DateTime, Timestamp, ProcessId, ThreadId" />
      <add name="TraceConsole" type="System.Diagnostics.ConsoleTraceListener" />
    </sharedListeners>
    <trace autoflush="true" />
  </system.diagnostics>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="System.Runtime.CompilerServices.Unsafe" publicKeyToken="b03f5f7f11d50a3a" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration>
